# Poki.ee 网站复刻项目

## 项目概述

这是一个用于学习研究的项目，通过 Next.js 复刻 https://poki.ee 网站的前端界面。

## 已完成的工作

✅ 项目结构搭建
- Next.js 14 + TypeScript + Tailwind CSS
- 自动化脚本工具集

✅ 核心功能
- 自动下载并提取网站内容
- 动态注入 head 和 body 内容
- 生成静态快照用于对比

✅ 视觉对比工具
- Playwright 自动截图
- Pixelmatch 像素级对比
- 差异区域分析

## 快速使用

### 第一次使用

```bash
# 1. 安装依赖
npm install

# 2. 获取网站内容
node scripts/fetchSite.js
node scripts/updateOriginalHtml.js

# 3. 启动开发服务器
npm run dev
```

访问 http://localhost:3000 即可看到复刻的网站。

### 更新网站内容

```bash
node scripts/fetchSite.js
node scripts/updateOriginalHtml.js
```

刷新浏览器即可看到更新。

## 技术实现

### 内容提取
- 使用 Node.js https 模块下载网站 HTML
- 正则表达式提取 `<head>` 和 `<body>` 内容
- 分别保存到 `data/` 目录

### Next.js 渲染
- `app/layout.tsx` 读取并注入 head 内容
- `app/page.tsx` 使用 `dangerouslySetInnerHTML` 渲染 body
- 保持原网站的 CSS 和 DOM 结构不变

### 视觉对比
- Playwright 在相同条件下截图（禁用 JS，1440×900 视口）
- Pixelmatch 进行像素级对比
- 生成差异热力图和统计数据

## 项目结构

```
.
├── app/                    # Next.js 应用
│   ├── layout.tsx         # 注入 head
│   ├── page.tsx           # 渲染 body
│   └── globals.css        # Tailwind CSS
├── data/                   # 提取的内容
│   ├── home-head.html     # head 部分
│   └── home-body.html     # body 部分
├── public/                 # 静态文件
│   └── original.html      # 完整快照
├── scripts/                # 自动化脚本
│   ├── fetchSite.js       # 下载并提取内容
│   ├── updateOriginalHtml.js    # 生成快照
│   ├── captureScreenshots.js    # 截图
│   ├── compareScreenshots.js    # 对比
│   └── analyzeRawDiff.js        # 分析差异
└── screenshots/            # 截图输出
    ├── original.png       # 原网站
    ├── clone.png          # 复刻版
    └── diff.png           # 差异图
```

## 脚本说明

### fetchSite.js
自动下载 poki.ee 的 HTML 并提取 head 和 body 内容。

### updateOriginalHtml.js
将提取的内容合并成完整的 HTML 文件，保存到 `public/original.html`。

### captureScreenshots.js
使用 Playwright 截取原网站和复刻版的全页面截图。

### compareScreenshots.js
使用 Pixelmatch 对比两张截图，生成差异图和统计数据。

### analyzeRawDiff.js
分析差异图，输出差异区域的边界框坐标。

## 注意事项

1. **动态内容差异**：原网站可能加载广告、分析脚本等，即使禁用 JavaScript 也可能有 2-3% 的像素差异。

2. **资源加载**：某些外部资源（图片、字体等）可能因网络原因加载失败，导致显示差异。

3. **仅供学习**：本项目仅用于学习研究目的，请勿用于商业用途。

## 常见问题

**Q: 页面显示不完整？**
A: 确保已运行 `node scripts/fetchSite.js` 获取最新内容。

**Q: 样式不正确？**
A: 检查 `data/home-head.html` 中的 CSS 链接是否正常加载。

**Q: 截图对比失败？**
A: 确保已安装 Playwright Chromium：`npx playwright install chromium`

**Q: 如何更新到最新版本？**
A: 重新运行 `node scripts/fetchSite.js` 即可。

## 技术栈

- **框架**: Next.js 14
- **语言**: TypeScript
- **样式**: Tailwind CSS
- **测试**: Playwright
- **对比**: Pixelmatch

## 参考文档

- [快速开始.md](./快速开始.md) - 简化的使用指南
- [REPLICATION.md](./REPLICATION.md) - 详细的复刻流程
- [README.md](./README.md) - 完整的项目文档
